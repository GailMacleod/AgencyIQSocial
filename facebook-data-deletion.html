<!DOCTYPE html>
<html>
<head>
    <title>Facebook Data Deletion</title>
    <meta charset="utf-8">
</head>
<body>
    <script>
        // Facebook Data Deletion Endpoint Handler
        const currentUrl = new URL(window.location.href);
        const method = 'GET'; // Default to GET for validation
        
        // Handle GET request (Facebook validation)
        if (method === 'GET' || currentUrl.searchParams.get('method') === 'get') {
            const response = {
                status: 'ok'
            };
            
            // Send response back to Facebook
            document.write('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
            
            // Also handle via fetch for proper response
            if (window.fetch) {
                fetch('/facebook-data-deletion', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(response => response.json())
                .then(data => {
                    console.log('Facebook validation response:', data);
                })
                .catch(error => {
                    console.log('Using fallback response for Facebook validation');
                });
            }
        }
        
        // Handle POST request (actual deletion)
        if (currentUrl.searchParams.get('method') === 'post') {
            const testUserId = 'user_' + Date.now();
            const confirmationCode = 'del_' + Date.now() + '_' + testUserId;
            const statusUrl = 'https://app.theagencyiq.ai/deletion-status/' + testUserId;
            
            const response = {
                url: statusUrl,
                confirmation_code: confirmationCode
            };
            
            document.write('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
        }
        
        // Display validation page
        if (!currentUrl.searchParams.get('method')) {
            document.write(`
                <h1>Facebook Data Deletion Endpoint</h1>
                <p><strong>Status:</strong> Active and Ready</p>
                <p><strong>GET Response:</strong> {"status": "ok"}</p>
                <p><strong>POST Response:</strong> Returns deletion confirmation URL and code</p>
                <p><strong>Last Updated:</strong> ${new Date().toISOString()}</p>
                
                <h2>Test Endpoints:</h2>
                <ul>
                    <li><a href="?method=get">Test GET Request</a></li>
                    <li><a href="?method=post">Test POST Request</a></li>
                </ul>
            `);
        }
    </script>
</body>
</html>