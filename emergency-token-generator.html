<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Token Generator - TheAgencyIQ Launch Fix</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .urgent { background: #dc3545; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .platform { background: white; border: 2px solid #dc3545; margin: 15px 0; padding: 20px; border-radius: 8px; }
        .operational { border-color: #28a745; }
        .step { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; }
        .link-button { display: inline-block; background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; margin: 10px 5px; }
        .link-button:hover { background: #0056b3; }
        .urgent-button { background: #dc3545; }
        .urgent-button:hover { background: #c82333; }
        .token-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <div class="urgent">
        <h1>EMERGENCY TOKEN REGENERATION - LAUNCH BLOCKED</h1>
        <p>Target Launch: 9:00 AM JST - June 23, 2025 | Current Status: 0/4 Platforms Operational</p>
    </div>

    <!-- X Platform Emergency Fix -->
    <div class="platform">
        <h2>üö® X Platform - CRITICAL FAILURE</h2>
        <p><strong>Issue:</strong> OAuth 2.0 App-only token detected. X requires User Context for posting.</p>
        
        <div class="step">
            <h3>URGENT: Generate X User Context Token</h3>
            <ol>
                <li>Open <a href="https://developer.twitter.com/en/portal/dashboard" target="_blank">X Developer Portal</a></li>
                <li>Select your app ‚Üí "Keys and tokens" tab</li>
                <li>Under "Authentication Tokens" ‚Üí Click "Regenerate"</li>
                <li>Ensure app permissions: "Read and write"</li>
                <li>Copy the new Access Token (starts with your user ID)</li>
            </ol>
            <a href="https://developer.twitter.com/en/portal/dashboard" target="_blank" class="link-button urgent-button">Open X Developer Portal</a>
        </div>
        
        <textarea class="token-input" placeholder="Paste new X_ACCESS_TOKEN here and add to Replit Secrets"></textarea>
        <button onclick="testXToken()" class="link-button">Test X Token</button>
        <div id="x-status"></div>
    </div>

    <!-- Facebook Platform Emergency Fix -->
    <div class="platform">
        <h2>üö® Facebook Platform - CRITICAL FAILURE</h2>
        <p><strong>Issue:</strong> Page token missing admin permissions and app secret proof validation.</p>
        
        <div class="step">
            <h3>URGENT: Generate Facebook Page Access Token</h3>
            <ol>
                <li>Open <a href="https://developers.facebook.com/tools/explorer/" target="_blank">Graph API Explorer</a></li>
                <li>Select your app from dropdown</li>
                <li>Click "Get Token" ‚Üí "Get Page Access Token"</li>
                <li>Select your business page</li>
                <li>Grant permissions: pages_manage_posts, pages_read_engagement</li>
                <li>Click "Generate Access Token"</li>
            </ol>
            <a href="https://developers.facebook.com/tools/explorer/" target="_blank" class="link-button urgent-button">Open Graph API Explorer</a>
        </div>
        
        <textarea class="token-input" placeholder="Paste new FACEBOOK_PAGE_ACCESS_TOKEN here and add to Replit Secrets"></textarea>
        <button onclick="testFacebookToken()" class="link-button">Test Facebook Token</button>
        <div id="facebook-status"></div>
    </div>

    <!-- LinkedIn Platform Emergency Fix -->
    <div class="platform">
        <h2>üö® LinkedIn Platform - CRITICAL FAILURE</h2>
        <p><strong>Issue:</strong> Access token revoked by user. Complete OAuth flow required.</p>
        
        <div class="step">
            <h3>URGENT: Generate LinkedIn Access Token</h3>
            <ol>
                <li>Open <a href="https://www.linkedin.com/developers/apps" target="_blank">LinkedIn Developer Portal</a></li>
                <li>Select your app ‚Üí "Auth" tab</li>
                <li>Copy OAuth 2.0 settings</li>
                <li>Complete authorization flow for posting permissions</li>
                <li>Exchange authorization code for access token</li>
            </ol>
            <a href="https://www.linkedin.com/developers/apps" target="_blank" class="link-button urgent-button">Open LinkedIn Developers</a>
        </div>
        
        <textarea class="token-input" placeholder="Paste new LINKEDIN_ACCESS_TOKEN here and add to Replit Secrets"></textarea>
        <button onclick="testLinkedInToken()" class="link-button">Test LinkedIn Token</button>
        <div id="linkedin-status"></div>
    </div>

    <!-- Instagram Platform Emergency Fix -->
    <div class="platform">
        <h2>üö® Instagram Platform - CRITICAL FAILURE</h2>
        <p><strong>Issue:</strong> Instagram Business Account not connected to Facebook Page.</p>
        
        <div class="step">
            <h3>URGENT: Connect Instagram Business Account</h3>
            <ol>
                <li>Open <a href="https://business.facebook.com/" target="_blank">Facebook Business Manager</a></li>
                <li>Go to Business Settings ‚Üí Accounts ‚Üí Instagram Accounts</li>
                <li>Click "Add" ‚Üí "Connect an Instagram Account"</li>
                <li>Log into your Instagram Business Account</li>
                <li>Connect it to your Facebook Page</li>
            </ol>
            <a href="https://business.facebook.com/" target="_blank" class="link-button urgent-button">Open Facebook Business</a>
        </div>
        
        <button onclick="testInstagramConnection()" class="link-button">Test Instagram Connection</button>
        <div id="instagram-status"></div>
    </div>

    <!-- Launch Status Dashboard -->
    <div class="platform">
        <h2>üéØ Launch Readiness Dashboard</h2>
        <button onclick="checkAllPlatforms()" class="link-button urgent-button">Check All Platforms</button>
        <div id="launch-status"></div>
        
        <div style="margin-top: 20px; text-align: center;">
            <p><strong>Time until launch: <span id="countdown"></span></strong></p>
        </div>
    </div>

    <script>
        // Countdown to 9:00 AM JST
        function updateCountdown() {
            const now = new Date();
            const launchTime = new Date('2025-06-23T09:00:00+09:00');
            const diff = launchTime - now;
            
            if (diff > 0) {
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                document.getElementById('countdown').textContent = `${hours}h ${minutes}m ${seconds}s`;
            } else {
                document.getElementById('countdown').textContent = 'LAUNCH TIME PASSED';
            }
        }
        
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Platform testing functions
        async function testXToken() {
            const status = document.getElementById('x-status');
            status.innerHTML = '<div class="status">Testing X token...</div>';
            
            try {
                const response = await fetch('/api/test-x-token', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    status.innerHTML = '<div class="status success">‚úÖ X Platform Operational!</div>';
                } else {
                    status.innerHTML = `<div class="status error">‚ùå X Platform Failed: ${data.error}</div>`;
                }
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå Test Error: ${error.message}</div>`;
            }
        }

        async function testFacebookToken() {
            const status = document.getElementById('facebook-status');
            status.innerHTML = '<div class="status">Testing Facebook token...</div>';
            
            try {
                const response = await fetch('/api/test-facebook-token', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    status.innerHTML = '<div class="status success">‚úÖ Facebook Platform Operational!</div>';
                } else {
                    status.innerHTML = `<div class="status error">‚ùå Facebook Platform Failed: ${data.error}</div>`;
                }
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå Test Error: ${error.message}</div>`;
            }
        }

        async function testLinkedInToken() {
            const status = document.getElementById('linkedin-status');
            status.innerHTML = '<div class="status">Testing LinkedIn token...</div>';
            status.innerHTML = '<div class="status error">‚ùå LinkedIn testing not implemented in interface</div>';
        }

        async function testInstagramConnection() {
            const status = document.getElementById('instagram-status');
            status.innerHTML = '<div class="status">Testing Instagram connection...</div>';
            status.innerHTML = '<div class="status error">‚ùå Instagram testing not implemented in interface</div>';
        }

        async function checkAllPlatforms() {
            const status = document.getElementById('launch-status');
            status.innerHTML = '<div class="status">Checking all platforms...</div>';
            
            try {
                const response = await fetch('/api/launch-readiness', { method: 'POST' });
                const data = await response.json();
                
                let statusHtml = '<h3>Platform Status:</h3><ul>';
                let operationalCount = 0;
                const totalPlatforms = Object.keys(data.platforms).length;
                
                for (const [platform, result] of Object.entries(data.platforms)) {
                    const statusIcon = result.operational ? '‚úÖ' : '‚ùå';
                    statusHtml += `<li>${statusIcon} ${platform.toUpperCase()}: ${result.operational ? 'OPERATIONAL' : 'NEEDS FIXING'}</li>`;
                    if (result.operational) operationalCount++;
                }
                
                statusHtml += '</ul>';
                statusHtml += `<h3>PLATFORMS OPERATIONAL: ${operationalCount}/${totalPlatforms}</h3>`;
                
                if (operationalCount === totalPlatforms) {
                    statusHtml = `<div class="status success">${statusHtml}<h2>üéØ ALL PLATFORMS READY - LAUNCH APPROVED!</h2></div>`;
                } else {
                    statusHtml = `<div class="status error">${statusHtml}<h2>‚ö†Ô∏è LAUNCH BLOCKED - FIX REQUIRED PLATFORMS</h2></div>`;
                }
                
                status.innerHTML = statusHtml;
                
            } catch (error) {
                status.innerHTML = `<div class="status error">‚ùå Check Error: ${error.message}</div>`;
            }
        }

        // Auto-check on page load
        window.onload = function() {
            checkAllPlatforms();
        };
    </script>
</body>
</html>