Diagnose Missing beacon.js
The 500 error likely stems from app.get('/public/js/beacon.js', ...) failing because dist/public/js/beacon.js doesn’t exist. Vite build may not include it if it’s not part of the source public/ or import tree.
Check Replit logs for "ENOENT: no such file or directory" or similar.
Update server/index.ts
Adjust to handle missing beacon.js gracefully and ensure other files are served correctly:
javascript

Collapse

Wrap

Run

Copy
const express = require('express');
const bodyParser = require('body-parser');
const path = require('path');
const app = express();
const baseUrl = process.env.NODE_ENV === 'production'
  ? 'https://app.theagencyiq.ai'
  : 'https://4fc77172-459a-4da7-8c33-5014abb1b73e-00-dqhtnud4ismj.worf.replit.dev';

// Middleware
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());

// Facebook Endpoint
app.all('/facebook', (req, res) => {
  try {
    const { code, signed_request } = { ...req.body, ...req.query };
    if (code) {
      res.status(200).json({ message: 'OAuth received', code });
    } else if (signed_request) {
      if (!signed_request) throw new Error('No signed_request');
      res.status(200).json({
        url: `${baseUrl}/deletion-status`,
        confirmation_code: 'del_' + Math.random().toString(36).substr(2, 9)
      });
    } else {
      throw new Error('Invalid Facebook request');
    }
  } catch (error) {
    console.error('Facebook Error:', error.stack);
    res.status(500).json({ error: 'Server error', details: process.env.NODE_ENV === 'development' ? error.message : undefined });
  }
});

// Static File Serving
const publicDir = path.join(__dirname, 'dist', 'public');
app.use(express.static(publicDir));
app.get('/manifest.json', (req, res) => {
  res.sendFile(path.join(publicDir, 'manifest.json'), (err) => {
    if (err) res.status(404).json({ error: 'Manifest not found' });
  });
});
app.get('/public/js/beacon.js', (req, res) => {
  res.set('Access-Control-Allow-Origin', '*');
  res.sendFile(path.join(publicDir, 'js', 'beacon.js'), (err) => {
    if (err) res.status(404).json({ error: 'Beacon not found' });
  });
});
app.get('*', (req, res) => res.status(404).json({ error: 'Not found' }));

// Global Error Handler
process.on('uncaughtException', (error) => {
  console.error('Uncaught:', error.stack);
});

const PORT = 5000;
app.listen(PORT, () => console.log(`Live on ${PORT}`));
Install: npm install express body-parser.
Fix Missing beacon.js
Option 1: Add to Source: If public/js/beacon.js exists in your project’s public/ directory, ensure it’s copied to dist/public/js/ during build. Check vite.config.ts for copy rules or manually place it.
Option 2: Remove Reference: If beacon.js isn’t needed, remove the app.get('/public/js/beacon.js', ...) line to avoid 500 errors.
Rebuild: npm run build.
Rebuild and Test
Restart server in Replit.