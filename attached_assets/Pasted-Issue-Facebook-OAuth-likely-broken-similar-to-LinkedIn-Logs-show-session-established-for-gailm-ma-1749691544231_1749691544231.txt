Issue: Facebook OAuth likely broken, similar to LinkedIn. Logs show session established for gailm@macleodglba.com.au (user_id: 2), but unrecognized features and passive event listener errors suggest frontend issues. Check Facebook app status and OAuth flow in server/routes.ts.

Steps:

Verify Facebook app in Developer Portal is active.
Ensure domains (e.g., https://app.theagencyiq.ai, http://localhost:5000) are added.
Update server/routes.ts for Facebook OAuth callback with live credentials.
ðŸ”§ Replit Prompt â€” Fix Facebook OAuth Connection

Task: Repair Facebook OAuth in server/routes.ts for user_id: 2, ensuring live credentials work. Validate and refresh tokens, preserving quota enforcement (12/27/52), 30-day reset, and all features (Brand Purpose, Google Analytics).

Requirements:

OAuth Fix:
Update server/routes.ts for /auth/facebook/callback:
Use live Facebook app ID/secret from environment variables.
Exchange code for access_token and refresh_token.
Update platform_connections for user_id: 2:
platform: 'facebook'
access_token, refresh_token, expires_at
is_active: true.
Redirect to app dashboard on success.
Validation:
Before /auth/facebook, ensure session user_id: 2 is active.
If no valid Facebook connection, show modal: "Connect your Facebook account."
Add token refresh if expires_at is near.
Preserve Existing Logic:
Maintain quota (12/27/52) and 30-day reset in post_ledger.
Keep post_schedule and post-publisher.ts unchanged.
Ensure Google Analytics triggers on successful posts.
API Behavior:

GET /auth/facebook:
Redirect to Facebook OAuth with scope (e.g., public_profile,publish_to_groups).
GET /auth/facebook/callback:
Process code, update platform_connections, redirect to /dashboard.
POST /approve-post:
Validate Facebook connection for user_id: 2.
Safeguards:

Use live credentials only.
Log callback errors.
Preserve all app functionality.
Commit Message:

text

Collapse

Wrap

Copy
fix: repair Facebook OAuth connection with live credentials and token refresh