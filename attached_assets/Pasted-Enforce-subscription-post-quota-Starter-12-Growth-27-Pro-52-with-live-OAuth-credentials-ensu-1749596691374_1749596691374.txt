Enforce subscription post quota (Starter: 12, Growth: 27, Pro: 52) with live OAuth credentials, ensuring "approve-post" works only with real user-connected social media accounts. Generate full quota drafts after Brand Purpose, count posts only on successful live posting, allow draft edits/regeneration, and reset quota every 30 days. No test credentials. Do not modify working features (Brand Purpose, Google Analytics).

Requirements:





Post Quota & Schedule Generation:





Quota: Starter (12), Growth (27), Pro (52).



Generate quota draft posts after Brand Purpose completion.



Posts counted only on successful live "Approve & Post" via OAuth.



Live OAuth Enforcement:





Require valid platform_connections (user_id, platform, access_token, etc.) with live credentials.



Block "Approve & Post" if no active platform connection exists:





Show modal: "Connect your social media account to post."



Update post-publisher.ts to use live Instagram credentials directly and extend to all platforms with proper OAuth flows (e.g., Facebook, TikTok).



Ensure routes.ts OAuth routes handle live authentication callbacks correctly.



Post Counting:





On "Approve & Post":





Validate: Active platform connection, status = draft, used_posts < quota.



Post to live platform using OAuth access_token.



On success (API 200): Set status = posted, is_counted = true, increment post_ledger.used_posts.



Fire Google Analytics event: post_success.



If used_posts >= quota or no connection:





Disable "Approve & Post".



Show modal: "Post limit reached or account not connected. Upgrade or connect to continue."



Editing & Schedule Regeneration:





Allow unlimited edits/reordering of draft posts.



Regeneration: Generate quota posts, reuse unposted drafts, add new ones to hit quota, lock posted items.



Disable "Generate New Schedule" if used_posts >= quota or no connection.



30-Day Rolling Period:





Track cycle: isCurrentCycle = (now - period_start) < 30 * 24 * 60 * 60 * 1000.



Reset used_posts = 0 when cycle ends.

Schema:





platform_connections:





user_id: string (mobile number UID)



platform: string



platform_user_id: string



platform_username: string



access_token: string



refresh_token: string



expires_at: datetime



is_active: boolean



post_schedule: (unchanged)



post_ledger: (unchanged)

API Behavior:





POST /generate-schedule:





Generate quota posts if platform connected.



Block if used_posts >= quota or no connection.



POST /approve-post:





Validate: Active connection, status = draft, used_posts < quota.



Post with live OAuth token.



On success: Update status, increment used_posts, trigger analytics.

Safeguards:





Server-side validation with live OAuth tokens.



No test credentials (e.g., test_access_token_fb).



Preserve Brand Purpose, OAuth flow, and analytics.



Handle token expiration with refresh_token.

Commit Message:

feat: enforce quota with live OAuth, require platform connections, update post-publisher.ts for live credentials