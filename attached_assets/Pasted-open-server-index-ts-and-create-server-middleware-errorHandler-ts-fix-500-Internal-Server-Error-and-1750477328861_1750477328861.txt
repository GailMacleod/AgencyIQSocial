open server/index.ts and create server/middleware/errorHandler.ts, fix 500 Internal Server Error and stabilize OAuth: 1) In server/index.ts, redefine /api/oauth to initialize passport with minimal strategies (Facebook: 'public_profile pages_show_list pages_manage_posts', LinkedIn: 'r_liteprofile w_member_social', X/Twitter: 'tweet.read tweet.write', Instagram: 'instagram_basic pages_show_list pages_manage_posts', YouTube: 'https://www.googleapis.com/auth/youtube'), validate tokens against PostgreSQL 'connections' table, refresh with refresh_token if expiring within 1 hour, log 'OAuth token [phone] [platform] [status]' (status: valid/refreshed/redirect). 2) Add /api/health to ping each platform API (e.g., Facebook Graph API, Twitter API), logging 'Health [phone] [platform] [status]' (status: up/down). 3) In server/middleware/errorHandler.ts, export a middleware function to catch errors, log full stack trace with 'Error [phone] [message]', return 500 with 'Server error, retrying connection', and redirect to /connect if OAuth-related. 4) Apply errorHandler middleware to all /api/* routes in server/index.ts. Commit with message 'fix-500-oauth-stabilize' without deploying. Run locally (NODE_ENV=production tsx server/index.ts), access https://app.theagencyiq.ai, navigate to /schedule, verify no 500 errors, check auto-connections, and review logs at 05:00 PM AEST on Friday, June 20, 2025. Report outcome (e.g., no 500 errors, connections stable, logs present) and issues, including full console output."

Instructions:

Open server/index.ts, redefine /api/oauth with passport strategies and token logic.
Add /api/health with platform pings.
Create server/middleware/errorHandler.ts with error middleware.
Apply errorHandler to /api/* routes in server/index.ts.
Save all files.
Commit with git add -A && git commit -m "fix-500-oauth-stabilize" (do not deploy).
Run locally with NODE_ENV=production tsx server/index.ts.
Access https://app.theagencyiq.ai, check /schedule, verify stability.
At 05:00 PM AEST on Friday, June 20, 2025, review console logs.
Report outcome and issues with full console output.